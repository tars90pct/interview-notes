# Load Balancer

當系統需處理大量流量時，負載平衡器用於將請求分散至多台機器（即「水平擴容」），避免單一機器過載或形成熱點（Hotspot）。在面試情境中，可將負載平衡器視為黑盒抽象，其核心任務是均勻分配工作負載。

## 使用時機：

- 任何有多台機器能處理相同請求的場景均需負載平衡器。
- SSL 終止（SSL Termination）：在 L7 負載平衡器統一處理 SSL 加解密，減輕後端伺服器負擔。
  - 在 AWS ALB（Application Load Balancer）啟用 SSL Termination，上傳商城的 SSL 證書。ALB 解密請求後，根據 URL 路徑路由：
    - /api/\* → 後端微服務叢集（如訂單服務、支付服務）。
    - /\* → 靜態網頁伺服器叢集。
    - 後端伺服器僅處理純 HTTP 業務邏輯，提升處理效率。
    ```
    [用戶瀏覽器] -- HTTPS (加密) --> [負載平衡器] -- HTTP (明文) --> [Web 伺服器叢集]
    ```
  - 也有混合型的安全架構
    - 負載平衡器（如 NGINX）執行 SSL Termination，對外提供 HTTPS。
    - 二次加密：負載平衡器與後端伺服器間使用自簽證書或 IPsec 建立加密通道。
    ```
    [用戶] -- HTTPS --> [NGINX] -- HTTPS (內部加密) --> [後端伺服器]
    ```
- 避免在負載平衡器實作複雜業務邏輯，應交由後端服務處理。

## 功能：

- 設定定期健康檢查（如 HTTP /health 端點），自動隔離故障節點。
- 粘性會話（Sticky Sessions）：確保同一用戶請求持續導向同一後端伺服器（如購物車暫存）。
- 若需粘性會話，確保後端服務支援無狀態或共用 Session 儲存（如 Redis）。
- 持久連線（Persistent Connections）：維持長連線以減少 TCP 握手開銷。
- L4 負載平衡器(TCP/UDP)：基於 IP 與 Port 分配流量，高效低延遲。適合用於WebSocket、即時遊戲、串流媒體
- L7 負載平衡器(HTTP/HTTPS)：解析 HTTP 標頭，支援進階路由與內容處理。適用於REST API、網頁伺服器、微服務路由
- Service Mesh：負載平衡邏輯下沉至 Sidecar Proxy（如 Envoy），實現細粒度流量管理。
- 使用雲端託管服務（如 AWS ELB、GCP Cloud Load Balancing），自動整合擴縮容與監控。

負載平衡器是分散式系統的流量調度核心，其選擇需基於協議層級（L4/L7）與業務需求（如連線持久性）。面試中，強調其如何提升系統可用性與擴展性，並結合具體案例（如電商大促流量分配），能有效展現架構設計的周全性。
