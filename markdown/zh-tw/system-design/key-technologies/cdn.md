# CDN

現代系統通常需服務全球用戶，這使得將內容快速傳遞至世界各地使用者成為一大挑戰。無論一般用戶或技術面試官，皆期待極短的載入時間，延遲可能導致體驗不佳與流量流失。內容傳遞網路（CDN） 是一種利用分散式伺服器、根據用戶地理位置提供內容的快取機制，主要用於傳遞靜態內容（如圖像、影片、HTML 檔案），但也能應用於動態內容（如 API 回應）。

## 運作原理

- 地理就近快取：CDN 將內容暫存於靠近用戶的邊緣伺服器。
- 智能路由請求：當用戶請求內容時，CDN 會將請求導向最近的伺服器。
- 快取策略：
  - 若內容已存在於邊緣伺服器，直接回傳快取版本。
  - 若無快取內容，CDN 會從源伺服器（Origin Server）獲取資料，暫存後再提供給用戶。

## 關鍵知識

- CDNs are not just for static assets.

  雖然 CDN 常見於快取靜態內容（如圖片、影片、JavaScript 檔案），但它也能處理**動態內容的緩存**。此功能特別適合「高訪問量但低更新頻率」的內容。

  - 一篇每日僅更新一次的部落格文章，可透過 CDN 快取，減少原始伺服器負擔。
  - 電商網站的商品頁面若每日調整價格一次，CDN 可在價格更新前持續提供快取版本，平衡即時性與效能。

- CDNs can be used to cache API responses.

  若 API 被頻繁呼叫（例如天氣預報或即時股價查詢），透過 CDN 快取回應能顯著降低伺服器壓力，同時加速回應速度。

  - 設定適當的 TTL（存活時間），例如每小時更新一次的氣象資料，可將 TTL 設為 3600 秒，確保資料定期刷新。
  - 搭配 Cache-Control 標頭，動態控制客戶端與 CDN 的快取行為。

- Eviction policies.

  CDN 會根據策略決定何時清除快取內容，常見機制包括：

  - TTL 過期：直接設定內容的快取有效時間，例如 24 小時後自動重新抓取。
  - 手動失效（Cache Invalidation）：當內容變更時，主動通知 CDN 清除舊快取。例如：
  - 透過 API 發送清除請求（Purge API）。
  - 在資源 URL 加入版本號（如 `style-v2.css`），強制用戶端載入新版本。
  - 基於資源的淘汰機制：如 LRU（最近最少使用）或 LFU（最不常使用），自動移除較少被訪問的內容。

## 技術面試常見應用場景

- 靜態媒體資源加速：最典型用途是快取圖像、影片等靜態檔案。例如：
  - 社群平台案例：Instagram 使用 CDN 快取用戶大頭照，確保全球用戶能快速載入。
  - 電商場景：商品圖片透過 CDN 分散式儲存，即使促銷活動期間流量暴增，仍能維持頁面載入速度。

## 延伸應用與進階功能

- 動態內容加速：部分 CDN 支援 API 路徑最佳化，透過 TCP 加速、路由優化降低延遲。
- 安全防護：整合 DDoS 防禦與 WAF（Web 應用防火牆），例如 Cloudflare 提供的安全服務。
- 影音串流：支援 HLS/DASH 協定分片傳輸，優化 4K 影片的全球播放流暢度。

#### 補充資料：CDN 效能指標

| 指標         | 說明                         | 優化案例                         |
| ------------ | ---------------------------- | -------------------------------- |
| 快取命中率   | 邊緣伺服器直接回應請求的比例 | 設定適當 TTL 提升重複內容命中率  |
| 延遲降低率   | 相較直連源站減少的延遲百分比 | 亞洲用戶訪問美西源站可降低 200ms |
| 頻寬成本節省 | 透過邊緣節點分流減輕源站負載 | 熱門影片節省 70% 源站頻寬        |

透過 CDN 的戰略性部署，企業能顯著提升全球服務品質，同時降低基礎設施成本，這在分散式系統設計與雲端架構面試中，是展現技術深度的關鍵知識點。
